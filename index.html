<script>
  const input = document.getElementById('busca-endereco');
  const btnBuscar = document.getElementById('btn-buscar');

  function buscarEndereco() {
    const query = input.value.trim();
    if (!query) return alert('Digite um endereço para buscar.');

    // URL da API Nominatim (OpenStreetMap)
    const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=1&addressdetails=1&accept-language=pt`;

    fetch(url)
      .then(response => response.json())
      .then(data => {
        if (!data || data.length === 0) {
          alert('Endereço não encontrado.');
          return;
        }

        const result = data[0];
        const lat = parseFloat(result.lat);
        const lon = parseFloat(result.lon);
        const coord = ol.proj.fromLonLat([lon, lat]);

        // Centraliza e dá zoom
        map.getView().animate({ center: coord, zoom: 16 });

        // Remove marcador antigo, se houver
        map.getLayers().getArray().forEach(layer => {
          if (layer.get('name') === 'buscaEndereco') {
            map.removeLayer(layer);
          }
        });

        // Cria marcador vermelho
        const marker = new ol.Feature({
          geometry: new ol.geom.Point(coord)
        });

        const vectorSource = new ol.source.Vector({
          features: [marker]
        });

        const markerLayer = new ol.layer.Vector({
          source: vectorSource,
          style: new ol.style.Style({
            image: new ol.style.Circle({
              radius: 6,
              fill: new ol.style.Fill({ color: 'red' }),
              stroke: new ol.style.Stroke({ color: '#fff', width: 2 })
            })
          })
        });

        markerLayer.set('name', 'buscaEndereco');
        map.addLayer(markerLayer);
      })
      .catch(err => {
        console.error('Erro na busca:', err);
        alert('Erro ao buscar endereço. Tente novamente.');
      });
  }

  btnBuscar.addEventListener('click', buscarEndereco);
  input.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      buscarEndereco();
    }
  });
</script>
